"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[758],{5758:function(e,t,a){a.r(t),a.d(t,{IonicPasskeysWeb:function(){return s}});var r=a(9895);class s extends r.Uw{async passkeyRegister(e){try{let t=JSON.parse(e.challenge),a={publicKey:Object.assign(Object.assign({},t.publicKey),{challenge:this.base64ToArrayBuffer(t.publicKey.challenge),user:Object.assign(Object.assign({},t.publicKey.user),{id:this.base64ToArrayBuffer(t.publicKey.user.id)}),excludeCredentials:t.publicKey.excludeCredentials.map(e=>Object.assign(Object.assign({},e),{id:this.base64ToArrayBuffer(e.id)}))})};console.log("publicKeyCredentialCreationOptions",a);let r=await navigator.credentials.create(a),s=r||{},n=Object.assign(Object.assign({},s),{id:s.id,type:s.type,rawId:this.base64UrlEncode(s.rawId),response:Object.assign(Object.assign({},s.response),{clientDataJSON:this.base64UrlEncode(s.response.clientDataJSON),attestationObject:this.base64UrlEncode(s.response.attestationObject)})});if(!r)throw Error("Failed to create credentials");return{credential:JSON.stringify(n)}}catch(e){throw Error(`Registration failed: ${e.message||"An unknown error occurred"}`)}}async passkeyAuthenticate(e){try{let t=JSON.parse(e.challenge),a={publicKey:Object.assign(Object.assign({},t.publicKey),{challenge:this.base64ToArrayBuffer(t.publicKey.challenge),allowCredentials:t.publicKey.allowCredentials.map(e=>Object.assign(Object.assign({},e),{id:this.base64ToArrayBuffer(e.id)}))})},r=await navigator.credentials.get(a),s=r||{},n=Object.assign(Object.assign({},s),{authenticatorAttachment:s.authenticatorAttachment,id:s.id,type:s.type,rawId:this.base64UrlEncode(s.rawId),response:Object.assign(Object.assign({},s.response),{clientDataJSON:this.base64UrlEncode(s.response.clientDataJSON),authenticatorData:this.base64UrlEncode(s.response.authenticatorData),signature:this.base64UrlEncode(s.response.signature),userHandle:this.base64UrlEncode(s.response.userHandle)})});if(!r)throw Error("Failed to create credentials");return{credential:JSON.stringify(n)}}catch(e){throw Error(`Authentication failed: ${e.message||"An unknown error occurred"}`)}}base64UrlEncode(e){let t=new Uint8Array(e),a="";for(let e=0;e<t.length;e++)a+=String.fromCharCode(t[e]);return btoa(a).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}base64ToArrayBuffer(e){let t=atob(e=e.replace(/-/g,"+").replace(/_/g,"/")),a=new Uint8Array(t.length);for(let e=0;e<t.length;e++)a[e]=t.charCodeAt(e);return a.buffer}}}}]);